"use strict";$(document).ready(function(){setTimeout(getData,500);setTimeout(checkAccount,1000);});const farm=[{"constant":true,"inputs":[{"name":"farmer","type":"address"}],"name":"dividendsOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"payoutsTo","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalUSDC","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newCollateralPercent","type":"uint256"},{"name":"newNutsPercent","type":"uint256"}],"name":"modifyPercents","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balances","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lastDeposit","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"claimYield","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"amount","type":"uint256"}],"name":"withdrawAfterSystemClosed","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"profitPerShare","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"amount","type":"uint256"}],"name":"cashout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"amount","type":"uint256"}],"name":"deposit","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];const uniswapV2=[{"constant":true,"inputs":[{"name":"amountOut","type":"uint256"},{"name":"path","type":"address[]"}],"name":"getAmountsIn","outputs":[{"name":"amounts","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"amountOutMin","type":"uint256"},{"name":"path","type":"address[]"},{"name":"to","type":"address"},{"name":"deadline","type":"uint256"}],"name":"swapExactETHForTokens","outputs":[{"name":"amounts","type":"uint256[]"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"amountIn","type":"uint256"},{"name":"path","type":"address[]"}],"name":"getAmountsOut","outputs":[{"name":"amounts","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"amountOut","type":"uint256"},{"name":"path","type":"address[]"},{"name":"to","type":"address"},{"name":"deadline","type":"uint256"}],"name":"swapETHForExactTokens","outputs":[{"name":"amounts","type":"uint256[]"}],"payable":true,"stateMutability":"payable","type":"function"}];const erc20=[{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"},{"name":"data","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"tokenOwner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Approval","type":"event"}];const farmAddress="0x54f84fb988e2b246150b13b6b5e55a0737d20cda";const collateralAddress="0x4b70388eabb6b7596dcf78e9c8dfb6328b5442a1";const barnBridge="0xb0fa2beee3cf36a7ac7e99b885b48538ab364853";var provider;var web3;var farmContract;var account;async function getData(){if(typeof window.ethereum!=='undefined'){web3=new Web3(window.ethereum);farmContract=web3.eth.contract(farm).at(farmAddress);updateData();}else if(web3Modal.cachedProvider){provider=await web3Modal.connect();web3=new Web3(provider);farmContract=web3.eth.contract(farm).at(farmAddress);updateData();}else if(web3){farmContract=web3.eth.contract(farm).at(farmAddress);updateData();}}
var usdcBalance;var daiBalance;var susdBalance;var bondPrice;var ethPrice;var usdcFarming;var totalEth;function updateData(){farmContract.totalUSDC((err,result)=>{usdcFarming=web3.fromWei(result,"mwei");updateAPY();$("#totalDeposited").text("$"+Math.floor(usdcFarming*100)/100);});web3.eth.getBalance(collateralAddress,function(error,result){totalEth=web3.fromWei(result,"ether");updateAPY();$('#totalCollateral').text(Math.floor(totalEth*100)/100+" eth");$('#totalCollateral2').text(Math.floor(totalEth*1000)/1000+" ETH");});const usdc=web3.eth.contract(erc20).at("0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48");usdc.balanceOf(barnBridge,(err,result)=>{usdcBalance=web3.fromWei(result,"mwei");updateAPY();});const dai=web3.eth.contract(erc20).at("0x6b175474e89094c44da98b954eedeac495271d0f");dai.balanceOf(barnBridge,(err,result)=>{daiBalance=web3.fromWei(result,"ether");updateAPY();});const susd=web3.eth.contract(erc20).at("0x57ab1ec28d129707052df4df418d58a2d46d5f51");susd.balanceOf(barnBridge,(err,result)=>{susdBalance=web3.fromWei(result,"ether");updateAPY();});const uniswap=web3.eth.contract(uniswapV2).at("0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D");uniswap.getAmountsOut(1000000000000000000,["0x0391d2021f89dc339f60fff84546ea23e337750f","0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2","0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"],(err,result)=>{bondPrice=web3.fromWei(result[2],"mwei");updateAPY();});uniswap.getAmountsOut(1000000000000000000,["0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2","0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"],(err,result)=>{ethPrice=web3.fromWei(result[1],"mwei");updateAPY();});setTimeout(updateData,5000);}
function updateAPY(){if(usdcBalance!=null&&daiBalance!=null&&susdBalance!=null&&bondPrice!=null&&ethPrice!=null&&totalEth!=null&&usdcFarming!=null){const totalFarming=usdcBalance.plus(daiBalance).plus(susdBalance);const weeklyBondPerDollar=32000/totalFarming;const apy=(((1+weeklyBondPerDollar*bondPrice)**52)-1)*100;const collateralRatio=usdcFarming/(ethPrice*totalEth);$("#farmAPY").text((Math.round(apy*6)/10)+"%");$("#insureAPY").text((Math.round(apy*collateralRatio*4)/10)+"%");}}
function checkAccount(){if(web3&&web3.eth){web3.eth.getAccounts((err,accounts)=>{if(accounts==null||accounts.length==0){console.log("NO ACCOUNT CONNECTED");}else{if(account!=accounts[0]){account=accounts[0];}
if(account!=null){$("#startFarming").text("Start Farming").removeAttr('onclick').off('click').click(startFarming);$("#startInsuring").text("Start Insuring").removeAttr('onclick').off('click').click(startInsuring);}}});}
setTimeout(checkAccount,1000);}
async function connectAccount(){try{if(typeof window.ethereum!=='undefined'){window.ethereum.enable();web3=new Web3(window.ethereum);}else{provider=await web3Modal.connect();web3=new Web3(provider);}
farmContract=web3.eth.contract(farm).at(farmAddress);updateData();}catch(e){console.log("Could not get a wallet connection",e);return;}}
function startFarming(){window.location="https://squirrel.finance/farm.html";}
function startInsuring(){window.location="https://squirrel.finance/insurefarm.html";}
const Web3Modal=window.Web3Modal.default;const WalletConnectProvider=window.WalletConnectProvider.default;const Fortmatic=window.Fortmatic;const providerOptions={walletconnect:{package:WalletConnectProvider,options:{infuraId:"8043bb2cf99347b1bfadfb233c5325c0",}},fortmatic:{package:Fortmatic,options:{key:"pk_live_802838FFFD42846E"}}};const web3Modal=new Web3Modal({network:"mainnet",cacheProvider:true,providerOptions,disableInjectedProvider:false});